<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <title>Minhas Sessões</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="p-4 bg-gradient-to-br from-indigo-900 to-purple-800 min-h-screen text-white font-sans">
  <h2 class="text-3xl font-bold mb-6">Histórico de Sessões</h2>

  <div id="lista-sessoes" class="space-y-4"></div>

  <script>
    const idUsuario = localStorage.getItem('id');
    const lista = document.getElementById('lista-sessoes');

    async function carregarSessoes() {
      try {
        const res = await fetch(`http://localhost:3000/sessoes/paciente/${idUsuario}`);
        if (!res.ok) throw new Error('Erro ao buscar sessões');
        const sessoes = await res.json();

        lista.innerHTML = '';

        if (sessoes.length === 0) {
          lista.innerHTML = `
            <div class="bg-white bg-opacity-10 p-6 rounded-lg shadow text-center">
              <p class="text-lg">Nenhum histórico de sessão encontrado.</p>
              <a href="#" onclick="carregarPagina({ id: 'agendar-sessao', nome: 'Agendar Sessão' })" 
                 class="mt-4 inline-block bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded transition">
                Agendar Sessão
              </a>
            </div>
          `;
        } else {
          sessoes.forEach(sessao => {
            const item = document.createElement('div');
            item.className = 'bg-white bg-opacity-10 p-4 rounded shadow';

            const data = new Date(sessao.data).toLocaleDateString('pt-BR');

            item.innerHTML = `
              <p><strong>Data:</strong> ${data}</p>
              <p><strong>Terapeuta:</strong> ${sessao.nomeTerapeuta}</p>
              ${sessao.diagnostico ? `<p><strong>Diagnóstico:</strong> ${sessao.diagnostico}</p>` : ''}
              ${sessao.terapia ? `<p><strong>Terapia Aplicada:</strong> ${sessao.terapia}</p>` : ''}
            `;

            lista.appendChild(item);
          });
        }
      } catch (e) {
        lista.innerHTML = `<p class="text-red-400">Erro ao carregar sessões: ${e.message}</p>`;
      }
    }

    // Permite navegação via menu lateral (usado no dashboard)
    function carregarPagina(pagina) {
      localStorage.setItem('paginaSelecionada', pagina.id);
      document.getElementById('titulo').innerText = pagina.nome;
      fetch(`paginas/${pagina.id}.html`)
        .then(res => res.text())
        .then(html => document.getElementById('content').innerHTML = html);
    }

    carregarSessoes();
  </script>
</body>
</html>
